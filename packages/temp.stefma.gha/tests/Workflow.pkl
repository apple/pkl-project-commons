//===----------------------------------------------------------------------===//
// Copyright Â© 2025 Apple Inc. and the Pkl project authors. All rights reserved.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     https://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
//===----------------------------------------------------------------------===//
module temp.stefma.gha.Workflow.tests

amends "pkl:test"

import "pkl:test"
import "../Workflow.pkl"

examples {
  ["basic"] {
    import("../examples/TestWorkflow.pkl").output.text
  }
  ["workflowTriggers"] {
    import("../examples/WorkflowTriggers.pkl").output.text
  }
  ["updateWikiReadme"] {
    import("../examples/UpdateWikiReadme.pkl").output.text
  }
  ["matrixTest"] {
    import("../examples/MatrixTest.pkl").output.text
  }
  ["reusableWorkflow"] {
    import("../examples/ReusableWorkflow.pkl").output.text
  }
  ["prebuildActions"] {
    import("../examples/PrebuildActions.pkl").output.text
  }
}

facts {
  ["jobIdTest"] {
    local function createJobs(id: String): Workflow.Jobs = new { [id] {} }
    test.catchOrNull(() -> createJobs("validJobId")) == null
    test.catchOrNull(() -> createJobs("ValidJobId")) == null
    test.catchOrNull(() -> createJobs("_validJobId")) == null
    test.catchOrNull(() -> createJobs("validJobId-_0123456789")) == null
    test.catchOrNull(() -> createJobs("this is throwing")) != null
    test.catchOrNull(() -> createJobs("7hisIsThrowing")) != null
    test.catchOrNull(() -> createJobs("-7hisIsThrowing")) != null
  }
}

